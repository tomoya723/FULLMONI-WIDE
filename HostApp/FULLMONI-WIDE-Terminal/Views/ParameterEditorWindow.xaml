<Window x:Class="FullmoniTerminal.Views.ParameterEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Parameter Editor - FULLMONI-WIDE (Issue #50: 警告設定対応)"
        Height="750" Width="900"
        MinHeight="650" MinWidth="850"
        Background="{StaticResource PrimaryBackgroundBrush}"
        WindowStartupLocation="CenterOwner">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" Text="パラメータ設定"
                   FontSize="20" FontWeight="Bold"
                   Foreground="{StaticResource TextBrush}"
                   Margin="0,0,0,16"/>

        <!-- Tab Control -->
        <TabControl Grid.Row="1" x:Name="MainTabControl"
                    Background="Transparent"
                    BorderBrush="{StaticResource BorderBrush}">

            <!-- 基本設定タブ -->
            <TabItem Header="基本設定">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="8">
                    <StackPanel>

                        <!-- Tyre Settings -->
                        <GroupBox Header="タイヤサイズ" Style="{StaticResource ModernGroupBox}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="幅 (mm):" Style="{StaticResource ModernLabel}" Margin="0,4"/>
                                <TextBox Grid.Row="0" Grid.Column="1" x:Name="TyreWidthBox"
                                         Style="{StaticResource ModernTextBox}" Margin="4" Width="100" HorizontalAlignment="Left"/>
                                <TextBlock Grid.Row="0" Grid.Column="2" Text="例: 195" Foreground="Gray" VerticalAlignment="Center" Margin="8,0"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="扁平率 (%):" Style="{StaticResource ModernLabel}" Margin="0,4"/>
                                <TextBox Grid.Row="1" Grid.Column="1" x:Name="TyreAspectBox"
                                         Style="{StaticResource ModernTextBox}" Margin="4" Width="100" HorizontalAlignment="Left"/>
                                <TextBlock Grid.Row="1" Grid.Column="2" Text="例: 55" Foreground="Gray" VerticalAlignment="Center" Margin="8,0"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="リム (inch):" Style="{StaticResource ModernLabel}" Margin="0,4"/>
                                <TextBox Grid.Row="2" Grid.Column="1" x:Name="TyreRimBox"
                                         Style="{StaticResource ModernTextBox}" Margin="4" Width="100" HorizontalAlignment="Left"/>
                                <TextBlock Grid.Row="2" Grid.Column="2" Text="例: 16" Foreground="Gray" VerticalAlignment="Center" Margin="8,0"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" x:Name="TyreSizePreview"
                                           Text="プレビュー: 195/55 R16" Foreground="{StaticResource AccentBrush}"
                                           FontWeight="Bold" Margin="0,8,0,0"/>
                            </Grid>
                        </GroupBox>

                        <!-- Gear Ratios -->
                        <GroupBox Header="ギア比 (x1000で入力)" Style="{StaticResource ModernGroupBox}" Margin="0,8,0,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="1速:" Style="{StaticResource ModernLabel}" Margin="0,4"/>
                                <TextBox Grid.Row="0" Grid.Column="1" x:Name="Gear1Box" Style="{StaticResource ModernTextBox}" Margin="4"/>

                                <TextBlock Grid.Row="0" Grid.Column="2" Text="2速:" Style="{StaticResource ModernLabel}" Margin="8,4,0,4"/>
                                <TextBox Grid.Row="0" Grid.Column="3" x:Name="Gear2Box" Style="{StaticResource ModernTextBox}" Margin="4"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="3速:" Style="{StaticResource ModernLabel}" Margin="0,4"/>
                                <TextBox Grid.Row="1" Grid.Column="1" x:Name="Gear3Box" Style="{StaticResource ModernTextBox}" Margin="4"/>

                                <TextBlock Grid.Row="1" Grid.Column="2" Text="4速:" Style="{StaticResource ModernLabel}" Margin="8,4,0,4"/>
                                <TextBox Grid.Row="1" Grid.Column="3" x:Name="Gear4Box" Style="{StaticResource ModernTextBox}" Margin="4"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="5速:" Style="{StaticResource ModernLabel}" Margin="0,4"/>
                                <TextBox Grid.Row="2" Grid.Column="1" x:Name="Gear5Box" Style="{StaticResource ModernTextBox}" Margin="4"/>

                                <TextBlock Grid.Row="2" Grid.Column="2" Text="6速:" Style="{StaticResource ModernLabel}" Margin="8,4,0,4"/>
                                <TextBox Grid.Row="2" Grid.Column="3" x:Name="Gear6Box" Style="{StaticResource ModernTextBox}" Margin="4"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="ファイナル:" Style="{StaticResource ModernLabel}" Margin="0,4"/>
                                <TextBox Grid.Row="3" Grid.Column="1" x:Name="FinalGearBox" Style="{StaticResource ModernTextBox}" Margin="4"/>

                                <TextBlock Grid.Row="3" Grid.Column="2" Grid.ColumnSpan="2"
                                           Text="例: 3.136 → 3136" Foreground="Gray" VerticalAlignment="Center" Margin="8,4"/>
                            </Grid>
                        </GroupBox>

                        <!-- Warning Settings -->
                        <GroupBox Header="警告設定" Style="{StaticResource ModernGroupBox}" Margin="0,8,0,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="水温 低温警告:" Style="{StaticResource ModernLabel}" Margin="0,4"/>
                                <TextBox Grid.Row="0" Grid.Column="1" x:Name="WaterTempLowBox"
                                         Style="{StaticResource ModernTextBox}" Margin="4" Width="80" HorizontalAlignment="Left"/>
                                <TextBlock Grid.Row="0" Grid.Column="2" Text="°C" Style="{StaticResource ModernLabel}" Margin="4"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="水温 高温警告:" Style="{StaticResource ModernLabel}" Margin="0,4"/>
                                <TextBox Grid.Row="1" Grid.Column="1" x:Name="WaterTempHighBox"
                                         Style="{StaticResource ModernTextBox}" Margin="4" Width="80" HorizontalAlignment="Left"/>
                                <TextBlock Grid.Row="1" Grid.Column="2" Text="°C" Style="{StaticResource ModernLabel}" Margin="4"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="燃料残量警告:" Style="{StaticResource ModernLabel}" Margin="0,4"/>
                                <TextBox Grid.Row="2" Grid.Column="1" x:Name="FuelWarnBox"
                                         Style="{StaticResource ModernTextBox}" Margin="4" Width="80" HorizontalAlignment="Left"/>
                                <TextBlock Grid.Row="2" Grid.Column="2" Text="%" Style="{StaticResource ModernLabel}" Margin="4"/>
                            </Grid>
                        </GroupBox>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- CAN設定タブ -->
            <TabItem Header="CAN設定">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="8">
                    <StackPanel>

                        <!-- CAN Channels -->
                        <GroupBox Header="受信チャンネル設定" Style="{StaticResource ModernGroupBox}" Margin="0,0,0,8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="50"/>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="60"/>
                                    <ColumnDefinition Width="50"/>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Header -->
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="CH" FontWeight="Bold" Margin="4"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="CAN ID" FontWeight="Bold" Margin="4"/>
                                <TextBlock Grid.Row="0" Grid.Column="2" Text="有効" FontWeight="Bold" Margin="4"/>
                                <TextBlock Grid.Row="0" Grid.Column="3" Text="CH" FontWeight="Bold" Margin="4"/>
                                <TextBlock Grid.Row="0" Grid.Column="4" Text="CAN ID" FontWeight="Bold" Margin="4"/>
                                <TextBlock Grid.Row="0" Grid.Column="5" Text="有効" FontWeight="Bold" Margin="4"/>

                                <!-- CH1-2 -->
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="1:" Style="{StaticResource ModernLabel}" Margin="4"/>
                                <TextBox Grid.Row="1" Grid.Column="1" x:Name="CanCh1IdBox" Style="{StaticResource ModernTextBox}" Margin="2" Text="0x3E8"/>
                                <CheckBox Grid.Row="1" Grid.Column="2" x:Name="CanCh1EnabledBox" IsChecked="True" VerticalAlignment="Center" Margin="4"/>
                                <TextBlock Grid.Row="1" Grid.Column="3" Text="2:" Style="{StaticResource ModernLabel}" Margin="4"/>
                                <TextBox Grid.Row="1" Grid.Column="4" x:Name="CanCh2IdBox" Style="{StaticResource ModernTextBox}" Margin="2" Text="0x3E9"/>
                                <CheckBox Grid.Row="1" Grid.Column="5" x:Name="CanCh2EnabledBox" IsChecked="True" VerticalAlignment="Center" Margin="4"/>

                                <!-- CH3-4 -->
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="3:" Style="{StaticResource ModernLabel}" Margin="4"/>
                                <TextBox Grid.Row="2" Grid.Column="1" x:Name="CanCh3IdBox" Style="{StaticResource ModernTextBox}" Margin="2" Text="0x3EA"/>
                                <CheckBox Grid.Row="2" Grid.Column="2" x:Name="CanCh3EnabledBox" IsChecked="True" VerticalAlignment="Center" Margin="4"/>
                                <TextBlock Grid.Row="2" Grid.Column="3" Text="4:" Style="{StaticResource ModernLabel}" Margin="4"/>
                                <TextBox Grid.Row="2" Grid.Column="4" x:Name="CanCh4IdBox" Style="{StaticResource ModernTextBox}" Margin="2" Text="0x3EB"/>
                                <CheckBox Grid.Row="2" Grid.Column="5" x:Name="CanCh4EnabledBox" IsChecked="True" VerticalAlignment="Center" Margin="4"/>

                                <!-- CH5-6 -->
                                <TextBlock Grid.Row="3" Grid.Column="0" Text="5:" Style="{StaticResource ModernLabel}" Margin="4"/>
                                <TextBox Grid.Row="3" Grid.Column="1" x:Name="CanCh5IdBox" Style="{StaticResource ModernTextBox}" Margin="2" Text="0x3EC"/>
                                <CheckBox Grid.Row="3" Grid.Column="2" x:Name="CanCh5EnabledBox" IsChecked="True" VerticalAlignment="Center" Margin="4"/>
                                <TextBlock Grid.Row="3" Grid.Column="3" Text="6:" Style="{StaticResource ModernLabel}" Margin="4"/>
                                <TextBox Grid.Row="3" Grid.Column="4" x:Name="CanCh6IdBox" Style="{StaticResource ModernTextBox}" Margin="2" Text="0x3ED"/>
                                <CheckBox Grid.Row="3" Grid.Column="5" x:Name="CanCh6EnabledBox" IsChecked="False" VerticalAlignment="Center" Margin="4"/>
                            </Grid>
                        </GroupBox>

                        <!-- CAN Fields -->
                        <GroupBox Header="データフィールド定義 (Issue #50: 警告設定対応)" Style="{StaticResource ModernGroupBox}" Margin="0,8,0,0">
                            <StackPanel>
                                <TextBlock Text="フィールド設定 (最大16個) - 警告閾値: -32768=無効, その他=有効" Foreground="Gray" Margin="4,0,0,8"/>

                                <!-- DataGrid for Fields -->
                                <DataGrid x:Name="CanFieldsGrid"
                                          AutoGenerateColumns="False"
                                          CanUserAddRows="False"
                                          CanUserDeleteRows="False"
                                          HeadersVisibility="Column"
                                          GridLinesVisibility="Horizontal"
                                          Background="Transparent"
                                          RowBackground="#2D2D30"
                                          AlternatingRowBackground="#252526"
                                          BorderBrush="{StaticResource BorderBrush}"
                                          Height="300">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="#" Binding="{Binding Index}" Width="25" IsReadOnly="True"/>
                                        <DataGridTextColumn Header="CH" Binding="{Binding Channel}" Width="30"/>
                                        <DataGridTextColumn Header="Byte" Binding="{Binding StartByte}" Width="35"/>
                                        <DataGridTextColumn Header="Len" Binding="{Binding ByteCount}" Width="30"/>
                                        <DataGridTextColumn Header="Type" Binding="{Binding DataType}" Width="40"/>
                                        <DataGridTextColumn Header="End" Binding="{Binding Endian}" Width="35"/>
                                        <DataGridTextColumn Header="変数" Binding="{Binding TargetVar}" Width="35"/>
                                        <DataGridTextColumn Header="Off" Binding="{Binding Offset}" Width="35"/>
                                        <DataGridTextColumn Header="Mul" Binding="{Binding Multiplier}" Width="45"/>
                                        <DataGridTextColumn Header="Div" Binding="{Binding Divisor}" Width="45"/>
                                        <DataGridTextColumn Header="Dec" Binding="{Binding DecimalShift}" Width="30"/>
                                        <DataGridTextColumn Header="名前" Binding="{Binding Name}" Width="55"/>
                                        <DataGridTextColumn Header="単位" Binding="{Binding Unit}" Width="35"/>
                                        <DataGridCheckBoxColumn Header="Warn" Binding="{Binding WarnEnabled}" Width="40"/>
                                        <DataGridTextColumn Header="Lo" Binding="{Binding WarnLow}" Width="45"/>
                                        <DataGridTextColumn Header="Hi" Binding="{Binding WarnHigh}" Width="45"/>
                                        <DataGridCheckBoxColumn Header="有効" Binding="{Binding Enabled}" Width="40"/>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <TextBlock Text="Type: U=Unsigned, S=Signed  |  End: B=Big, L=Little  |  Mul/Div: 1000=x1.0"
                                           Foreground="Gray" Margin="4,8,0,0" FontSize="11"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- CAN Buttons -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                            <Button Content="CAN設定読込" Style="{StaticResource ModernButton}"
                                    Width="100" Margin="4" Click="CanReadButton_Click"/>
                            <Button Content="CAN設定書込" Style="{StaticResource ModernButton}"
                                    Width="100" Margin="4" Click="CanWriteButton_Click"/>
                            <Button Content="CAN保存(EEPROM)" Style="{StaticResource ModernButton}"
                                    Width="120" Margin="4" Click="CanSaveButton_Click"/>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

        </TabControl>

        <!-- Buttons -->
        <Grid Grid.Row="2" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="1" Content="読み込み" Style="{StaticResource ModernButton}"
                    Width="100" Margin="4" Click="ReadButton_Click"/>
            <Button Grid.Column="2" Content="書き込み" Style="{StaticResource ModernButton}"
                    Width="100" Margin="4" Click="WriteButton_Click"/>
            <Button Grid.Column="3" Content="保存 (EEPROM)" Style="{StaticResource ModernButton}"
                    Width="120" Margin="4" Click="SaveButton_Click"/>
            <Button Grid.Column="4" Content="閉じる" Style="{StaticResource ModernButton}"
                    Width="80" Margin="4" Click="CloseButton_Click"/>
        </Grid>
    </Grid>
</Window>
